<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <title>1Drop YaadVibe</title>
  <script src="https://cdn.jsdelivr.org/npm/qrcode.js@1.4.4/lib/qrcode.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Changa+One&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
  <style>
    :root {
      --green: #009B48; --gold: #FFD700; --black: #000;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Inter', sans-serif;
      background: #000 url('/IMG_0039.jpeg') center/cover no-repeat fixed;
      background-image: url('/IMG_0039.jpeg'), linear-gradient(135deg, rgba(0,0,0,0.15), rgba(0,155,72,0.25));
      color: #fff;
      min-height: 100dvh;
      overflow-x: hidden;
      position: relative;
    }
  .overlay {
  position: fixed; inset: 0;
  background: linear-gradient(135deg, rgba(0,0,0,0.04), rgba(0,155,72,0.08)); /* ← REDUCED */
  backdrop-filter: blur(1.5px); /* ← LIGHTER BLUR */
  z-index: 1;
  pointer-events: none;
}
   .flag {
  position: fixed; top: 16px; left: 16px;
  width: 100px; height: 68px;
  background: url('/IMG_0454.png') center/cover no-repeat;
  /* REMOVE background-color: #000; */
  animation: waveFlow 3s ease-in-out infinite;
  z-index: 10;
  border-radius: 4px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  pointer-events: auto;
  
  /* NEW: USE CSS MASK TO CUT OUT FLAG SHAPE */
  -webkit-mask: url('/IMG_0454.png') center/cover no-repeat;
  mask: url('/IMG_0454.png') center/cover no-repeat;
  background-color: transparent !important;
}
.flag::after {
  content: "1Drop"; font-weight: 900; font-size: 1.2rem;
  position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
  color: #fff; text-shadow: 0 0 4px #000; opacity: 0.8;
  z-index: 1;
}
    .flag:not([style*="url"])::after { display: block; }

    @keyframes waveFlow {
      0%, 100% { transform: rotate(0deg) scale(1); }
      50% { transform: rotate(2deg) scale(1.02); }
    }

    .container {
      position: relative; z-index: 2;
      max-width: 100%; padding: 1rem;
      display: flex; flex-direction: column; align-items: center;
      min-height: 100dvh; justify-content: flex-start;
    }

    .header {
      text-align: center; margin: 2.5rem 0 0.8rem; width: 100%;
    }
  .logo {
  font-family: 'Changa One', cursive;
  font-size: clamp(4.5rem, 16vw, 7rem);
  font-weight: 900;
  letter-spacing: -3px;
  margin-bottom: 0.5rem;
  text-align: center;
  position: relative;
  z-index: 3;
}
.logo span:first-child {
  background: linear-gradient(135deg, #FF4500, #FF0000, #DC143C);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  filter: drop-shadow(0 0 15px #FF4500);
}
.logo span:last-child {
  background: linear-gradient(135deg, #FFF8DC, #FFD700, #FFC107);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  filter: drop-shadow(0 0 20px #FFD700);
}
.logo span {
  animation: fyahPulse 3s ease-in-out infinite alternate;
}
@keyframes fyahPulse {
  0% { 
    filter: drop-shadow(0 0 15px #FF4500); 
    transform: scale(1);
  }
  100% { 
    filter: drop-shadow(0 0 25px #FFD700); 
    transform: scale(1.02);
  }
}
   .calc {
  position: relative;
  background: rgba(0,0,0,0.85);
  border: 2.5px solid #FFD700;
  border-radius: 16px;
  padding: 6px 12px;
  font-weight: 800;
  font-size: 1rem;
  color: #FFD700;
  max-width: 140px;
  backdrop-filter: blur(14px);
  box-shadow: 0 3px 16px rgba(255,215,0,0.35), 0 0 12px rgba(255,215,0,0.5) !important;
  top: 14vh;
  z-index: 3;
  transition: all 0.4s ease;
  display: inline-block;
}
.calc.expand { 
  max-width: 260px; 
  font-size: 1.3rem; 
  padding: 10px 16px; 
}
    .calc.animate { animation: countUp 0.6s ease-out; }
    @keyframes countUp { 0% { transform: scale(1); } 50% { transform: scale(1.15); } 100% { transform: scale(1); } }

   .msg {
  font-size: 1.6rem;
  font-weight: 700;
  color: #FFD700;
  text-shadow: 0 0 10px #000;
  margin-top: 17vh;
  max-width: 82%;
  text-align: center;
}
    .btn {
      width: 88dvw; max-width: 370px; padding: 1.45rem;
      border-radius: 22px; font-size: 1.45rem; font-weight: 700;
      border: none; cursor: pointer; margin: 0.9rem 0;
      box-shadow: 0 14px 30px rgba(0,0,0,0.65);
      transition: all .22s;
      pointer-events: auto !important;
    }
    .btn.gold { background: var(--gold); color: #000; }
    .btn.green { background: var(--green); color: #fff; border: 3.5px solid var(--gold); }
.btn.back {
  position: fixed;
  top: 88px; right: 18px; left: auto;
  background: transparent;
  border: 2.5px solid #FFD700;
  border-radius: 50%;
  width: 44px; height: 44px;
  display: flex; align-items: center; justify-content: center;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  z-index: 9999 !important;
  cursor: pointer;
  transition: all 0.3s ease;
  padding: 0;
  color: transparent; /* HIDE ANY TEXT */
  font-size: 0; /* SHRINK TEXT TO NOTHING */
  overflow: hidden; /* CLIP ANY STRAY CONTENT */}
.btn.back:hover {
  background: rgba(255, 215, 0, 0.2);
  transform: scale(1.08);
}
.btn.back svg {
  width: 20px; height: 20px;
  stroke: #FFD700; stroke-width: 3.5; fill: none;
}
    .btn:active { transform: scale(0.93); }

    .progress {
      display: flex; justify-content: center; gap: 8px; margin: 1rem 0;
    }
    .progress {
  display: flex; justify-content: center; gap: 12px; margin: 1rem 0; flex-wrap: wrap;
}
.prog-icon {
  width: 36px; height: 36px;
  border-radius: 50%;
  background: rgba(255,255,255,0.12);
  display: flex; align-items: center; justify-content: center;
  font-size: 18px;
  transition: all 0.3s ease;
  position: relative;
  backdrop-filter: blur(4px);
}
.prog-icon.active {
  background: var(--gold);
  color: #000;
  transform: scale(1.15);
  box-shadow: 0 0 20px rgba(255,215,0,0.6);
  animation: pulse 1.5s infinite;
}
.prog-icon.done::after {
  content: 'Check';
  position: absolute;
  top: -6px; right: -6px;
  width: 18px; height: 18px;
  background: var(--green);
  color: white;
  border-radius: 50%;
  font-size: 12px;
  display: flex; align-items: center; justify-content: center;
  border: 2px solid #000;
}
@keyframes pulse {
  0%, 100% { box-shadow: 0 0 20px rgba(255,215,0,0.6); }
  50% { box-shadow: 0 0 30px rgba(255,215,0,0.9); }
}
  

    .step { display: none; width: 100%; animation: fade 0.55s ease-out; }
    .step.active { display: block; }
    @keyframes fade { from { opacity: 0; transform: translateY(35px); } to { opacity: 1; transform: none; } }

    .option-card {
      background: rgba(255,255,255,0.16); border: 2.5px solid transparent;
      border-radius: 22px; padding: 1.3rem; margin: 1.1rem 0;
      display: flex; align-items: center; cursor: pointer;
      transition: all .3s; backdrop-filter: blur(14px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.38);
    }
    .option-card:hover { border-color: var(--gold); transform: translateY(-5px); }
    .option-card.selected { 
      border-color: var(--gold); 
      background: rgba(255,215,0,0.22);
      box-shadow: 0 0 20px rgba(255,215,0,0.4);
      transform: scale(1.02);
    }
    .option-card img { width: 84px; height: 84px; object-fit: cover; border-radius: 16px; margin-right: 18px; }
    .option-card .info { flex: 1; }
    .option-card .name { font-weight: 700; font-size: 1.25rem; }
    .option-card .price { color: var(--gold); font-weight: 700; font-size: 1.35rem; }

    input, select {
      width: 88dvw; max-width: 350px; padding: 20px 17px;
      border-radius: 22px; background: rgba(255,255,255,0.15);
      border: 2.5px solid #666; color: #fff; font-size: 1.3rem;
      margin: 1.1rem 0; backdrop-filter: blur(11px);
    }

    .occupancy {
      display: flex; gap: 16px; justify-content: center; margin: 1.1rem 0;
    }
    .occupancy select {
      width: 42dvw; max-width: 165px; padding: 16px; font-size: 1.2rem;
    }

    .nights {
      display: flex; align-items: center; gap: 16px; margin: 1.3rem 0;
      font-size: 1.35rem; font-weight: 700;
      flex-wrap: wrap; justify-content: center;
    }
    .nights button {
      width: 48px; height: 48px; border-radius: 50%;
      background: var(--gold); color: #000; font-size: 1.7rem;
      border: none; cursor: pointer;
    }

    #summary-items .item {
      display: flex; justify-content: space-between; padding: 1.1rem 0;
      border-bottom: 1.5px solid rgba(255,255,255,0.32); font-size: 1.25rem;
    }
    .total { font-size: 2rem; font-weight: 700; color: var(--gold); text-align: center; margin: 2.2rem 0; }

    .trust {
  position: fixed;
  bottom: 18px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 0.9rem;
  color: #FFD700;
  z-index: 5;
  text-align: center;
}
.trust a { color: #00CED1; text-decoration: underline; }

    @media (min-width: 400px) {
      .btn, input, select { width: 350px; }
      .occupancy select { width: 165px; }
    }

    .header > * { width: 100%; text-align: center; }
    .container > * { max-width: 380px; width: 100%; margin-left: auto; margin-right: auto; }
  </style>
</head>
<body>
  <div class="overlay"></div>
  <div class="flag"></div>

  <div class="container">
    <div class="header">
      <h1 class="logo">
  <span>YAAD</span><br>
  <span>VIBE</span>
</h1>
      <div class="calc">Total: $<span id="liveTotal">0.00</span></div>
      <div class="progress" id="progress"></div>
    </div>

    <!-- STEP 0 -->
    <div id="step0" class="step active">
      <p class="msg">Can we help you book a vacation package?</p>
      <button class="btn gold" id="startBtn">Start Building</button>
      <div class="trust">Trusted by 500+ travelers • <a href="#">Read reviews</a></div>
    </div>

    <!-- STEP 1 -->
    <div id="step1" class="step">
      <p class="msg">Are you traveling to Jamaica?</p>
      <div class="option-card selected" data-value="yes">
        <div class="info"><div class="name">Yes, from abroad</div></div>
      </div>
      <div class="option-card" data-value="no">
        <div class="info"><div class="name">No, I'm local</div></div>
      </div>
    </div>

    <!-- STEP 2 -->
    <div id="step2" class="step">
    <!-- REPLACE THIS ENTIRE BUTTON -->
<button class="btn back" onclick="goBack()">
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#FFD700" stroke-width="3" stroke-linejoin="round">
    <path d="M19 12H5M12 19l-7-7 7-7" />
  </svg>
</button>
      <p class="msg">Where are you traveling from?</p>
      <select id="fromCity">
        <option value="">Select City</option>
        <option>Miami, USA</option>
        <option>New York, USA</option>
        <option>London, UK</option>
        <option>Toronto, Canada</option>
        <option>Kingston, Jamaica</option>
        <option>Montego Bay, Jamaica</option>
      </select>
      <button class="btn green" id="btn2">Next</button>
    </div>

    <!-- STEP 2.5: FLIGHT BOOKING -->
    <div id="step25" class="step">
      <button class="btn back" id="backX" onclick="goBack()" aria-label="Go back">
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" 
       stroke="#FFD700" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
    <path d="M19 12H5M12 19l-7-7 7-7" />
  </svg>
</button>
      <p class="msg">Book your flight?</p>
      <div class="option-card" data-flight="skip">
        <div class="info"><div class="name">No, I’ll book later</div></div>
      </div>
      <div id="flight-options"></div>
      <button class="btn green" id="btnFlight">Next to Dates</button>
    </div>

    <!-- STEP 3 -->
    <div id="step3" class="step">
      <button class="btn back" id="backX" onclick="goBack()" aria-label="Go back">
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" 
       stroke="#FFD700" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
    <path d="M19 12H5M12 19l-7-7 7-7" />
  </svg>
</button>
      <p class="msg">Arrival & Departure</p>
      <input type="date" id="arriveDate">
      <input type="date" id="departDate">
      <div class="occupancy">
        <select id="adults">
          <option value="1">1 Adult</option>
          <option value="2" selected>2 Adults</option>
          <option value="3">3 Adults</option>
          <option value="4">4 Adults</option>
        </select>
        <select id="kids">
          <option value="0" selected>0 Kids</option>
          <option value="1">1 Kid</option>
          <option value="2">2 Kids</option>
          <option value="3">3 Kids</option>
        </select>
      </div>
      <div class="nights">
        <button id="minus">-</button>
        <span id="nightCount">1</span> night(s)
        <button id="plus">+</button>
      </div>
      <button class="btn green" id="btn3">Next</button>
    </div>

    <!-- STEP 4 -->
    <div id="step4" class="step">
      <button class="btn back" id="backX" onclick="goBack()" aria-label="Go back">
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" 
       stroke="#FFD700" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
    <path d="M19 12H5M12 19l-7-7 7-7" />
  </svg>
</button>
      <p class="msg">What parish will you stay in?</p>
      <div id="parish-options"></div>
      <button class="btn green" id="parishNext" style="display:none">Next to Choose Vibe</button>
    </div>

    <!-- STEP 5 -->
    <div id="step5" class="step">
      <button class="btn back" id="backX" onclick="goBack()" aria-label="Go back">
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" 
       stroke="#FFD700" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
    <path d="M19 12H5M12 19l-7-7 7-7" />
  </svg>
</button>
      <p class="msg">What vibe — Inland or Coastal?</p>
      <div class="option-card" data-value="coastal">
        <div class="info"><div class="name">Coastal</div></div>
      </div>
      <div class="option-card" data-value="inland">
        <div class="info"><div class="name">Inland</div></div>
      </div>
      <button class="btn green" id="btnVibe">Next to Choose Stay</button>
    </div>

    <!-- STEP 6 -->
    <div id="step6" class="step">
      <button class="btn back" id="backX" onclick="goBack()" aria-label="Go back">
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" 
       stroke="#FFD700" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
    <path d="M19 12H5M12 19l-7-7 7-7" />
  </svg>
</button>
      <p class="msg">Choose your stay</p>
      <div id="stay-options"></div>
      <button class="btn green" id="btnStay">Next to Transport</button>
    </div>

    <!-- STEP 7 -->
    <div id="step7" class="step">
      <button class="btn back" id="backX" onclick="goBack()" aria-label="Go back">
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" 
       stroke="#FFD700" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
    <path d="M19 12H5M12 19l-7-7 7-7" />
  </svg>
</button>
      <p class="msg">Need a ride? (optional)</p>
      <div id="transport-options"></div>
      <button class="btn green" id="btnTransport">Next to Tours</button>
    </div>

    <!-- STEP 8 -->
    <div id="step8" class="step">
      <button class="btn back" id="backX" onclick="goBack()" aria-label="Go back">
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" 
       stroke="#FFD700" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
    <path d="M19 12H5M12 19l-7-7 7-7" />
  </svg>
</button>
      <p class="msg">Add tours (optional)</p>
      <div id="tour-options"></div>
      <button class="btn green" id="btnTours">Show My Package</button>
    </div>

    <!-- SUMMARY -->
    <div id="summary" class="step">
      <button class="btn back" id="backX" onclick="goBack()" aria-label="Go back">
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" 
       stroke="#FFD700" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
    <path d="M19 12H5M12 19l-7-7 7-7" />
  </svg>
</button>
      <p class="msg">Your YaadVibe Package</p>
      <div id="summary-items"></div>
      <div class="total">Total: $<span id="total">0.00</span></div>
      <button class="btn gold" id="btnPay">Pay with TON Wallet</button>
      <div id="qr-area" style="margin:2.2rem 0; text-align:center;"></div>
    </div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const PARISH_TOWNS = {
    "clarendon": "May Pen", "hanover": "Lucea", "kingston": "Kingston", "manchester": "Mandeville",
    "portland": "Port Antonio", "saint-andrew": "Half Way Tree", "saint-ann": "St. Ann’s Bay",
    "saint-catherine": "Spanish Town", "saint-elizabeth": "Black River", "saint-james": "Montego Bay",
    "saint-mary": "Port Maria", "saint-thomas": "Morant Bay", "trelawny": "Falmouth",
    "westmoreland": "Savanna-la-Mar"
  };
  const ALL_PARISHES = Object.keys(PARISH_TOWNS);

  const LIVE_DATA = {
    accommodations: {
      "saint-james": [
        {name:"Round Hill • Villa 10",price:680,source:"Luxury",img:"https://www.roundhill.com/wp-content/uploads/2023/06/Round-Hill-Villa-Exterior.jpg",type:"coastal"},
        {name:"Iberostar Rose Hall",price:420,source:"Resort",img:"https://dynamic-media-cdn.tripadvisor.com/media/photo-o/2a/2d/3g.jpg?w=1200",type:"coastal"}
      ],
      "kingston": [
        {name:"Pegasus Kingston (3 nights, 2A/0K)",price:540,source:"Hotel",img:"https://cf.bstatic.com/xdata/images/hotel/max1280x900/483221417.jpg",type:"inland"},
        {name:"Blue Mountain Coffee Tour",price:95,source:"Tour",img:"/IMG_0039.jpeg",type:"inland"}
      ],
      "default": [
        {name:"Local Guesthouse",price:120,source:"Budget",img:"/IMG_0039.jpeg",type:"inland"},
        {name:"Airbnb Villa",price:280,source:"Private",img:"/IMG_0039.jpeg",type:"coastal"}
      ]
    },
    transport: {
      "saint-james": [{name:"Private Transfer MBJ to Round Hill",price:120},{name:"Knutsford Express",price:45},{name:"Local Taxi",price:80}],
      "kingston": [{name:"Lynk Airport to City",price:25},{name:"JUTC Bus",price:2},{name:"Private Driver",price:80}],
      "default": [{name:"Local Taxi",price:60},{name:"Route Taxi",price:5}]
    },
    tours: {
      "saint-james": [{name:"Rick’s Café Sunset",price:65},{name:"YS Falls + Black River",price:110},{name:"Negril Beach Day",price:50}],
      "kingston": [{name:"Bob Marley Museum",price:30},{name:"Devon House + Jerk",price:45},{name:"Blue Mountain Coffee Tour",price:95}],
      "default": [{name:"Local Market Tour",price:35},{name:"Nature Walk",price:20}]
    },
    flights: {
      "Kingston, Jamaica": [
        {airline:"Caribbean Airlines", code:"BW123", price:85, arrive:"2025-06-15", depart:"2025-06-20"},
        {airline:"Fly Jamaica", code:"FJ456", price:72, arrive:"2025-06-16", depart:"2025-06-21"}
      ],
      "Montego Bay, Jamaica": [
        {airline:"InterCaribbean", code:"JY789", price:68, arrive:"2025-06-17", depart:"2025-06-22"}
      ],
      "default": [
        {airline:"Caribbean Air", code:"CA999", price:299, arrive:"2025-06-15", depart:"2025-06-20"}
      ]
    }
  };

  let state = { 
    from:'', arrive:'', depart:'', parish:'', vibe:'', stay:null, 
    transport:[], tours:[], nights:1, adults:2, kids:0, isLocal: false, flight: null 
  };
  let total = 0;
  let tonConnectUI;
  let currentStep = 0;
  const totalSteps = 9;

  try {
    tonConnectUI = new window.TonConnectUI({
      manifestUrl: 'https://yaadvibe.com/tonconnect-manifest.json',
      buttonRootId: null
    });
  } catch(e) { console.warn("TON Connect not loaded"); }

  const updateCalc = (animate = false) => {
    const prevTotal = total;
    total = 0;
    if (state.stay) {
      const base = state.stay.price * state.nights;
      const occupancyFee = state.adults > 2 ? (state.adults - 2) * 50 : 0;
      total += base + occupancyFee + Math.round(base * 0.05);
    }
    state.transport.forEach(t => total += t.price);
    state.tours.forEach(t => total += t.price);
    if (state.flight) total += state.flight.price;

    const el = document.getElementById('liveTotal');
    el.textContent = total.toFixed(2);
    if (animate && total !== prevTotal) {
      el.parentElement.classList.add('animate');
      setTimeout(() => el.parentElement.classList.remove('animate'), 600);
    }
  };

  const PROGRESS_ICONS = ['Jamaica', 'Plane', 'Calendar', 'Pin', 'Palm', 'Hotel', 'Taxi', 'Star', 'Money'];

const updateProgress = () => {
  const prog = document.getElementById('progress');
  prog.innerHTML = '';
  const stepMap = [1, 2, 3, 4, 5, 6, 7, 8, 9]; // maps currentStep → icon index

  PROGRESS_ICONS.forEach((icon, i) => {
    const span = document.createElement('span');
    span.className = 'prog-icon';
    span.textContent = icon;
    span.dataset.step = i;

  const isActive = i === 
  (currentStep === 0 ? 0 :
   currentStep === 1 ? 0 :
   currentStep === 2.5 ? 1 :
   currentStep >= 2 ? Math.min(currentStep - 1, 8) : 0);

const isDone = i < (currentStep === 9 ? 8 : 
                   currentStep === 2.5 ? 1 :
                   currentStep >= 2 ? Math.min(currentStep - 1, 8) : 0);
    if (isActive) span.classList.add('active');
    if (isDone && !isActive) span.classList.add('done');

    prog.appendChild(span);
  });
};
const next = n => {
  console.log(`→ Moving to step: ${n}`);
  document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
  document.getElementById('step0').classList.remove('active');

  const targetId = n === 9 ? 'summary' : (n === 2.5 ? 'step25' : 'step' + n);
  const target = document.getElementById(targetId);
  if (target) {
    target.classList.add('active');
    currentStep = n;
    updateProgress();
    updateCalc(true);
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }
};

const goBack = () => {
  if (currentStep > 0) {
    const prev = currentStep === 2.5 ? 2 : Math.floor(currentStep) - 1;
    next(prev);
  }
};  
});
 const calcNightsFromDates = () => {
    const arrive = document.getElementById('arriveDate').value;
    const depart = document.getElementById('departDate').value;
    if (arrive && depart) {
      const diff = (new Date(depart) - new Date(arrive)) / 86400000;
      if (diff > 0) {
        state.nights = diff;
        document.getElementById('nightCount').textContent = diff;
        updateCalc(true);
      }
    }
  };

  const renderParishes = () => {
    const c = document.getElementById('parish-options'); c.innerHTML = '';
    ALL_PARISHES.forEach(p => {
      const display = `${p.replace(/-/g,' ').replace(/\b\w/g, l => l.toUpperCase())} (${PARISH_TOWNS[p]})`;
      const card = document.createElement('div');
      card.className = 'option-card';
      card.innerHTML = `<div class="info"><div class="name">${display}</div></div>`;
      card.onclick = () => {
        c.querySelectorAll('.option-card').forEach(x => x.classList.remove('selected'));
        card.classList.add('selected');
        state.parish = p;
        document.getElementById('parishNext').style.display = 'block';
      };
      c.appendChild(card);
    });
  };

  const loadStays = () => {
    const c = document.getElementById('stay-options');
    c.innerHTML = '<p style="text-align:center;color:#aaa">Finding your vibe...</p>';
    setTimeout(() => {
      c.innerHTML = '';
      const items = LIVE_DATA.accommodations[state.parish] || LIVE_DATA.accommodations.default;
      const filtered = state.vibe ? items.filter(i => i.type === state.vibe) : items;
      filtered.forEach(item => {
        const card = document.createElement('div');
        card.className = 'option-card';
        card.innerHTML = `
          <img src="${item.img}" onerror="this.src='/IMG_0039.jpeg'" alt="${item.name}">
          <div class="info">
            <div class="name">${item.name}</div>
            <div class="price">$${item.price}${item.source === 'Tour' ? '' : '/night'}</div>
          </div>
        `;
        card.onclick = () => {
          c.querySelectorAll('.option-card').forEach(x => x.classList.remove('selected'));
          card.classList.add('selected');
          state.stay = {...item, fee: Math.round(item.price * 0.05)};
          updateCalc(true);
        };
        c.appendChild(card);
      });
    }, 600);
  };

  const loadTransport = () => {
    const c = document.getElementById('transport-options'); c.innerHTML = '';
    const opts = LIVE_DATA.transport[state.parish] || LIVE_DATA.transport.default;
    opts.forEach(t => {
      const card = document.createElement('div');
      card.className = 'option-card';
      card.innerHTML = `<div class="info"><div class="name">${t.name}</div><div class="price">$${t.price}</div></div>`;
      card.onclick = () => {
        card.classList.toggle('selected');
        if (card.classList.contains('selected')) state.transport.push(t);
        else state.transport = state.transport.filter(x => x.name !== t.name);
        updateCalc(true);
      };
      c.appendChild(card);
    });
  };

  const loadTours = () => {
    const c = document.getElementById('tour-options'); c.innerHTML = '';
    const opts = LIVE_DATA.tours[state.parish] || LIVE_DATA.tours.default;
    opts.forEach(t => {
      const card = document.createElement('div');
      card.className = 'option-card';
      card.innerHTML = `<div class="info"><div class="name">${t.name}</div><div class="price">$${t.price}</div></div>`;
      card.onclick = () => {
        card.classList.toggle('selected');
        if (card.classList.contains('selected')) state.tours.push(t);
        else state.tours = state.tours.filter(x => x.name !== t.name);
        updateCalc(true);
      };
      c.appendChild(card);
    });
  };

  const loadFlights = () => {
    const c = document.getElementById('flight-options'); c.innerHTML = '';
    const opts = LIVE_DATA.flights[state.from] || LIVE_DATA.flights.default;
    opts.forEach(f => {
      const card = document.createElement('div');
      card.className = 'option-card';
      card.innerHTML = `
        <div class="info">
          <div class="name">${f.airline} • ${f.code}</div>
          <div class="price">$${f.price} roundtrip</div>
        </div>
      `;
      card.onclick = () => {
        document.querySelectorAll('#flight-options .option-card').forEach(x => x.classList.remove('selected'));
        card.classList.add('selected');
        state.flight = f;
      };
      c.appendChild(card);
    });
  };

  const showSummary = () => {
    const div = document.getElementById('summary-items'); div.innerHTML = '';
    const add = (label, price, fee = 0) => {
      div.innerHTML += `<div class="item"><span>${label}</span><span>$${price}${fee ? ` + <strong>$${fee}</strong> fee` : ''}</span></div>`;
    };
    if (state.stay) {
      const base = state.stay.price * state.nights;
      const occupancyFee = state.adults > 2 ? (state.adults - 2) * 50 : 0;
      add(`${state.stay.name} (${state.nights} nights, ${state.adults}A/${state.kids}K)`, base + occupancyFee, Math.round(base * 0.05));
    }
    state.transport.forEach(t => add(t.name, t.price));
    state.tours.forEach(t => add(t.name, t.price));
    if (state.flight) add(`${state.flight.airline} Flight`, state.flight.price);
    document.getElementById('total').textContent = total.toFixed(2);
    next(9);
  };

  // PAYMENT
  document.getElementById('btnPay').onclick = async () => {
    if (total === 0) return alert("Add items first!");
    if (!tonConnectUI) return alert("TON Wallet not available");

    const finalTotal = total;
    const payload = { ...state, total: finalTotal };

    try {
      const tx = {
        validUntil: Math.floor(Date.now() / 1000) + 300,
        messages: [{
          address: "EQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAM9c",
          amount: String(Math.round(finalTotal * 1e9)),
          payload: btoa(JSON.stringify(payload))
        }]
      };
      const result = await tonConnectUI.sendTransaction(tx);
      alert(`Payment sent! Total: $${finalTotal.toFixed(2)}\nTx: ${result.boc}`);
      new QRCode(document.getElementById("qr-area"), {
        text: result.boc, width: 240, height: 240,
        colorDark: "#FFD700", colorLight: "#000"
      });
    } catch (e) {
      alert("Payment failed: " + e.message);
    }
  };
document.getElementById('startBtn').addEventListener('click', () => {
  console.log("Start button clicked → going to step 1");
  next(1);
  setTimeout(() => {
    const yesCard = document.querySelector('#step1.active .option-card[data-value="yes"]');
    if (yesCard) {
      yesCard.click();
      console.log("Auto-clicked 'Yes' → going to Step 2");
    }
  }, 200);
});

// STEP 1: "Are you traveling to Jamaica?" → Auto-click "Yes"
document.getElementById('step1').addEventListener('click', e => {
  const card = e.target.closest('.option-card');
  if (card) {
    document.querySelectorAll('#step1 .option-card').forEach(c => c.classList.remove('selected'));
    card.classList.add('selected');
    state.isLocal = card.dataset.value === 'no';

    setTimeout(() => {
      next(2);
      if (state.isLocal) {
        setTimeout(renderParishes, 100);
      }
    }, 150);
  }
});

// STEP 2: "Where from?" → Next to Flights or Dates
document.getElementById('btn2').onclick = () => {
  state.from = document.getElementById('fromCity').value;
  if (!state.from) return alert("Choose your city!");
  if (!state.isLocal) {
    loadFlights();
    next(2.5);
  } else {
    next(3);
  }
};

// STEP 2.5: Flight Booking
document.getElementById('step25').addEventListener('click', e => {
  const card = e.target.closest('.option-card');
  if (card && card.dataset.flight === 'skip') {
    document.querySelectorAll('#step25 .option-card').forEach(c => c.classList.remove('selected'));
    card.classList.add('selected');
    state.flight = null;
  }
});

document.getElementById('btnFlight').onclick = () => {
  const selected = document.querySelector('#flight-options .option-card.selected');
  if (!selected && !state.flight) {
    alert("Choose a flight or skip");
    return;
  }
  if (state.flight) {
    document.getElementById('arriveDate').value = state.flight.arrive;
    document.getElementById('departDate').value = state.flight.depart;
    calcNightsFromDates();
  }
  next(3);
};

  document.getElementById('btn2').onclick = () => {
    state.from = document.getElementById('fromCity').value;
    if (!state.from) return alert("Choose your city!");
    if (!state.isLocal) { loadFlights(); next(2.5); } else { next(3); }
  };

  document.getElementById('step25').addEventListener('click', e => {
    const card = e.target.closest('.option-card');
    if (card && card.dataset.flight === 'skip') {
      document.querySelectorAll('#step25 .option-card').forEach(c => c.classList.remove('selected'));
      card.classList.add('selected');
      state.flight = null;
    }
  });

  document.getElementById('btnFlight').onclick = () => {
    if (state.flight) {
      document.getElementById('arriveDate').value = state.flight.arrive;
      document.getElementById('departDate').value = state.flight.depart;
      calcNightsFromDates();
    }
    next(3);
  };

  ['adults','kids'].forEach(id => {
    document.getElementById(id).onchange = e => { state[id] = +e.target.value; updateCalc(true); };
  });

  document.getElementById('minus').onclick = () => { if (state.nights > 1) { state.nights--; document.getElementById('nightCount').textContent = state.nights; updateCalc(true); } };
  document.getElementById('plus').onclick = () => { state.nights++; document.getElementById('nightCount').textContent = state.nights; updateCalc(true); };

  document.getElementById('departDate').addEventListener('change', calcNightsFromDates);

  document.getElementById('btn3').onclick = () => {
    state.arrive = document.getElementById('arriveDate').value;
    state.depart = document.getElementById('departDate').value;
    if (!state.arrive || !state.depart) return alert("Pick both dates!");
    next(4);
    renderParishes();
  };

  document.getElementById('parishNext').onclick = () => {
    if (!state.parish) return alert("Choose parish!");
    next(5);
  };

  document.getElementById('btnVibe').onclick = () => {
    const sel = document.querySelector('#step5 .option-card.selected');
    if (!sel) return alert("Choose vibe!");
    state.vibe = sel.dataset.value;
    loadStays();
    next(6);
  };

  document.getElementById('btnStay').onclick = () => {
    if (!state.stay) return alert("Pick stay!");
    loadTransport();
    next(7);
  };

  document.getElementById('btnTransport').onclick = () => { loadTours(); next(8); };
  document.getElementById('btnTours').onclick = showSummary;

  document.getElementById('step5').addEventListener('click', e => {
    const card = e.target.closest('.option-card');
    if (card) {
      document.querySelectorAll('#step5 .option-card').forEach(c => c.classList.remove('selected'));
      card.classList.add('selected');
    }
  });
  document.querySelectorAll('.btn.back').forEach(btn => {
  btn.onclick = goBack;
});
// INIT
  updateProgress();
</script>
</body>
</html>
